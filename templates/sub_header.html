{% load static %}
<link rel="stylesheet" href="{% static 'styles/app.css' %}" />

<div id="sticky-bar">
  <header class="subheader">
    <div class="container container--narrow">
      <nav class="subheader__nav">
        <ul>
          <li class="subheader__menuItem" id="goldspot">Gold&nbsp;<span>${{gold_price}}</span></li>
          <li class="subheader__menuItem" id="silverspot">Silver&nbsp;<span>${{silver_price}}</span></li>
          <li class="subheader__menuItem" id="platinumspot">Platinum&nbsp;<span>${{platinum_price}}</span></li>
          <li class="subheader__menuItem"><a href="#" id="trigger-view"><span class="solar--refresh-square-broken" id="trigger-view-button"></span></a></li>
        </ul>
      </nav>
    </div>
  </header>
</div>

<!-- CSRF Token for AJAX requests -->
<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
  $(document).ready(function() {
      $('#trigger-view, #trigger-view-button').on('click', function(event) {
          event.preventDefault(); // Prevent the default action
          console.log('Anchor clicked');
          console.log('AJAX request is about to be made');

          $.ajax({
              type: 'POST',
              url: '{% url "reloadPrices" %}', // Ensure this is correctly rendered
              data: {
                  csrfmiddlewaretoken: '{{ csrf_token }}' // Include CSRF token
              },
              success: function(response) {
                  console.log('AJAX request succeeded');
                  console.log('Response:', response);
                  alert(response.message); // Handle the response
              },
              error: function(xhr, status, error) {
                  console.error('AJAX request failed:', status, error);
                  console.log('Response:', xhr.responseText);
                  console.log('Status:', status);
                  console.log('Error:', error);
              }
          });
      });
  });
</script>